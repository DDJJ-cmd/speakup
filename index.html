<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SpeakUp</title>
  <style>
    body {
      font-family: -apple-system, system-ui, sans-serif;
      background: #0b1220;
      color: #e9eefc;
      margin: 0;
      padding: 0 0 88px 0;
    }
    header {
      padding: 18px 14px;
      background: rgba(11,18,32,.9);
      border-bottom: 1px solid rgba(255,255,255,.1);
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(10px);
    }
    h1 { margin: 0; font-size: 18px; }
    .sub { margin-top: 6px; color: #a9b5d6; font-size: 12px; }
    main { padding: 12px 14px; }
    .row { margin: 8px 0; }
    .pill {
      display: inline-block;
      padding: 6px 10px;
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 20px;
      color: #a9b5d6;
      font-size: 12px;
      margin: 4px 4px 4px 0;
    }
    .card {
      background: #111b33;
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 16px;
      padding: 14px;
      margin: 12px 0;
    }
    .card h2 { margin: 0 0 10px 0; font-size: 16px; }
    .card h3 { margin: 14px 0 8px 0; font-size: 14px; color: #6ee7ff; }
    .muted { color: #a9b5d6; }
    .small { font-size: 12px; }
    ul { margin: 8px 0; padding-left: 20px; }
    li { margin: 6px 0; cursor: default; }
    .kw-item { cursor: pointer; }
    .btn {
      width: 100%;
      padding: 14px;
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 14px;
      background: linear-gradient(90deg, rgba(110,231,255,.18), rgba(124,255,166,.14));
      color: #fff;
      font-size: 16px;
      font-weight: bold;
      margin: 8px 0;
      cursor: pointer;
    }
    .btn-sec {
      background: rgba(255,255,255,.04);
      font-size: 14px;
      font-weight: normal;
    }
    textarea {
      width: 100%;
      height: 180px;
      padding: 12px;
      background: rgba(0,0,0,.3);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 12px;
      color: #fff;
      font-size: 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      box-sizing: border-box;
    }
    nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(11,18,32,.92);
      border-top: 1px solid rgba(255,255,255,.1);
      display: flex;
      padding: 10px 14px;
      gap: 6px;
      backdrop-filter: blur(10px);
    }
    nav button {
      flex: 1;
      padding: 10px;
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 12px;
      background: rgba(255,255,255,.03);
      color: #a9b5d6;
      font-size: 13px;
      cursor: pointer;
    }
    nav button.active {
      background: rgba(110,231,255,.12);
      color: #fff;
    }
    .hide { display: none; }
    .toast {
      position: fixed;
      bottom: 90px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,.9);
      color: #fff;
      padding: 10px 16px;
      border-radius: 12px;
      font-size: 13px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
      z-index: 999;
    }
    .toast.show { opacity: 1; }
    pre {
      margin: 0;
    }
  </style>
</head>

<body>
<header>
  <h1>SpeakUp</h1>
  <div class="sub">æ¯æ—¥20:00ï¼šæœªä½¿ç”¨ãªã‚‰é€šçŸ¥ â†’ ChatGPTã§è‹±ä¼šè©±ï¼ˆPWAåŒ–ã‚‚OKï¼‰</div>
</header>

<main>
  <!-- TODAY -->
  <section id="viewToday">
    <div class="row">
      <span class="pill" id="dateDisplay">----</span>
      <span class="pill" id="statusDisplay">çŠ¶æ…‹ï¼š--</span>
    </div>

    <div class="card">
      <h2 id="topicTitle">Loading...</h2>
      <div class="muted small" id="topicGuide">Loading guide...</div>

      <h3>Promptsï¼ˆé †ç•ªã«èãï¼‰</h3>
      <ul id="promptsList"></ul>

      <h3>Keywordsï¼ˆã‚¿ãƒƒãƒ—ã§å¾©ç¿’ï¼‰</h3>
      <ul id="keywordsList"></ul>

      <button class="btn" id="btnSpeakUp">Let's speak up!</button>

      <div class="small muted" style="margin-top:8px;">
        æŠ¼ã™ã¨ï¼šãŠé¡Œâ†’ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰â†’ChatGPTã‚’é–‹ã„ã¦ä¼šè©±é–‹å§‹ï¼ˆ& ä»Šæ—¥é–‹ã„ãŸãƒ•ãƒ©ã‚°ï¼‹å±¥æ­´ã‚’ä¿å­˜ï¼‰
      </div>
    </div>

    <div class="card">
      <h2>Notesä¿å­˜ç”¨ï¼ˆã„ã¤ã§ã‚‚å¾©ç¿’ï¼‰</h2>
      <div class="small muted">â€»ã€Œã‚³ãƒ”ãƒ¼ã€â†’ãƒ¡ãƒ¢ã«è²¼ã‚Šä»˜ã‘ã€‚ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆé€£æºã¯å¾Œã§OKã€‚</div>
      <div style="margin-top:10px;">
        <textarea id="notesArea"></textarea>
      </div>
      <button class="btn btn-sec" id="btnCopyNotes">ã‚³ãƒ”ãƒ¼</button>
    </div>

    <div class="card">
      <h2>å‹•ä½œç¢ºèªç”¨ãƒœã‚¿ãƒ³</h2>
      <button class="btn btn-sec" id="btnTestOpened">ä»Šæ—¥é–‹ã„ãŸã‚’è¨˜éŒ²ï¼ˆãƒ†ã‚¹ãƒˆï¼‰</button>
      <button class="btn btn-sec" id="btnClearOpened">ä»Šæ—¥é–‹ã„ãŸã‚’è§£é™¤ï¼ˆãƒ†ã‚¹ãƒˆï¼‰</button>
    </div>
  </section>

  <!-- HISTORY -->
  <section id="viewHistory" class="hide">
    <div class="card">
      <h2>Historyï¼ˆå¾©ç¿’ï¼‰</h2>
      <div class="small muted">"Let's speak up!" ã‚’æŠ¼ã—ãŸæ—¥ã®è¨˜éŒ²ï¼ˆæœ€å¤§20ä»¶ï¼‰</div>
      <div style="height:1px; background:rgba(255,255,255,.1); margin:12px 0;"></div>
      <div id="historyContent" class="small muted">èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>
    <div class="card">
      <button class="btn btn-sec" id="btnClearAllHistory">å±¥æ­´ã‚’å…¨å‰Šé™¤</button>
    </div>
  </section>

  <!-- SETTINGS -->
  <section id="viewSettings" class="hide">
    <div class="card">
      <h2>Settings</h2>
      <h3>ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°</h3>
      <pre id="logArea" style="font-family:ui-monospace,monospace; font-size:11px; color:#a9b5d6; white-space:pre-wrap; margin:10px 0;">èµ·å‹•ã—ã¾ã—ãŸ
</pre>
      <div class="small muted">
        â€»GitHub Pages ã§å‹•ã‹ã—ã¦ã„ã‚‹é–“ã¯ã€PWAç”¨ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆmanifest / icons / sw.jsï¼‰ã¯å¾Œã§è¿½åŠ ã§OKã€‚
      </div>
    </div>
  </section>
</main>

<nav>
  <button id="tab1" class="active">Today</button>
  <button id="tab2">History</button>
  <button id="tab3">Settings</button>
</nav>

<div class="toast" id="toastMsg"></div>

<script>
/* =========================
   1) Topics
========================= */
var topics = [
  {
    title: "Introducing HIP Concept to International Teams",
    guide: "HIPæ§‹æƒ³ã‚’æµ·å¤–ãƒ¡ãƒ³ãƒãƒ¼ã¸èª¬æ˜ã™ã‚‹æƒ³å®šã®ç·´ç¿’",
    prompts: [
      "How would you explain the HIP concept to a hotel operator?",
      "What business problem does HIP try to solve?",
      "How can automation improve hotel decision making?",
      "What makes HIP different from a traditional report?"
    ],
    keywords: [
      { en: "automation", ja: "è‡ªå‹•åŒ–", uses: "We focus on automation. / Automation reduces manual work. / Automation helps consistency." },
      { en: "data integration", ja: "ãƒ‡ãƒ¼ã‚¿çµ±åˆ", uses: "Data integration is essential. / We need better data integration. / Integration improves visibility." },
      { en: "workflow", ja: "æ¥­å‹™ãƒ•ãƒ­ãƒ¼", uses: "Let's redesign the workflow. / Workflow affects efficiency. / This workflow is simple." },
      { en: "insight", ja: "æ´å¯Ÿ", uses: "The system gives insight. / Insight drives strategy. / We need actionable insight." },
      { en: "dashboard", ja: "ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰", uses: "Check the dashboard daily. / Dashboard shows KPI. / We update the dashboard." }
    ]
  },
  {
    title: "Discussing ADR Strategy with Fusion Hotels",
    guide: "ADRæˆ¦ç•¥ã«ã¤ã„ã¦æµ·å¤–ãƒ›ãƒ†ãƒ«ã¨è­°è«–ã™ã‚‹ä¼šè©±",
    prompts: [
      "What factors influence ADR in your market?",
      "How do you balance ADR and occupancy?",
      "What pricing strategy works best in Vietnam?",
      "How do OTAs affect ADR performance?"
    ],
    keywords: [
      { en: "ADR", ja: "å¹³å‡å®¢å®¤å˜ä¾¡", uses: "ADR increased this month. / ADR impacts profit. / We monitor ADR daily." },
      { en: "pricing strategy", ja: "ä¾¡æ ¼æˆ¦ç•¥", uses: "We adjust pricing strategy. / Strategy depends on demand. / Pricing strategy is flexible." },
      { en: "demand", ja: "éœ€è¦", uses: "Demand is growing. / We forecast demand. / Demand changes seasonally." },
      { en: "OTA", ja: "ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ—…è¡Œä»£ç†åº—", uses: "OTA costs are rising. / OTA drives volume. / OTA strategy matters." },
      { en: "rate mix", ja: "æ–™é‡‘æ§‹æˆ", uses: "Rate mix changed. / Mix affects revenue. / Analyze rate mix monthly." }
    ]
  },
  {
    title: "Explaining Flow-Through Performance",
    guide: "Flow Throughã‚’æµ·å¤–ãƒ¡ãƒ³ãƒãƒ¼ã¸èª¬æ˜ã™ã‚‹ç·´ç¿’",
    prompts: [
      "How do you define flow-through in your hotel?",
      "Why is flow-through important for profitability?",
      "What causes low flow-through?",
      "How can teams improve flow-through results?"
    ],
    keywords: [
      { en: "flow-through", ja: "ãƒ•ãƒ­ãƒ¼ã‚¹ãƒ«ãƒ¼", uses: "Flow-through improved. / Monitor flow-through weekly. / Flow-through shows efficiency." },
      { en: "variable cost", ja: "å¤‰å‹•è²»", uses: "Variable cost increased. / Control variable cost. / Variable cost affects margin." },
      { en: "margin", ja: "åˆ©ç›Šç‡", uses: "Margin declined. / Improve margin strategy. / Margin is stable." },
      { en: "efficiency", ja: "åŠ¹ç‡æ€§", uses: "Efficiency matters. / Improve operational efficiency. / Efficiency reduces waste." },
      { en: "analysis", ja: "åˆ†æ", uses: "Data analysis is key. / We run analysis weekly. / Analysis supports decisions." }
    ]
  }
];

/* =========================
   2) Helpers
========================= */
function pad2(n){ return n < 10 ? '0' + n : '' + n; }

function log(msg){
  var el = document.getElementById('logArea');
  if(!el) return;
  var time = new Date().toLocaleTimeString();
  el.textContent = el.textContent + '[' + time + '] ' + msg + '\n';
}

function toast(msg){
  var el = document.getElementById('toastMsg');
  if(!el) return;
  el.textContent = msg;
  el.className = 'toast show';
  setTimeout(function(){ el.className = 'toast'; }, 1400);
}

function getDateString(){
  var d = new Date();
  return d.getFullYear() + '-' + pad2(d.getMonth()+1) + '-' + pad2(d.getDate());
}

function getTodayTopic(){
  // æ—¥ä»˜ã§ãƒ­ãƒ¼ãƒ†ï¼ˆtopicsãŒ3ä»¶ãªã‚‰3æ—¥ãƒ«ãƒ¼ãƒ—ï¼‰
  var d = new Date();
  var idx = (d.getDate() - 1) % topics.length;
  return topics[idx];
}

/* =========================
   3) Render
========================= */
function updateStatus(){
  var today = getDateString();
  document.getElementById('dateDisplay').textContent = today;

  var opened = localStorage.getItem('speakup_opened');
  document.getElementById('statusDisplay').textContent =
    (opened === today) ? 'çŠ¶æ…‹ï¼šæœ¬æ—¥åˆ©ç”¨æ¸ˆã¿' : 'çŠ¶æ…‹ï¼šæœªåˆ©ç”¨';

  log('Status updated');
}

function renderTopic(){
  var t = getTodayTopic();

  document.getElementById('topicTitle').textContent = t.title;
  document.getElementById('topicGuide').textContent = t.guide;

  // Prompts
  var pUl = document.getElementById('promptsList');
  pUl.innerHTML = '';
  for(var i=0;i<t.prompts.length;i++){
    var li = document.createElement('li');
    li.textContent = t.prompts[i];
    pUl.appendChild(li);
  }

  // Keywords
  var kUl = document.getElementById('keywordsList');
  kUl.innerHTML = '';
  for(var j=0;j<t.keywords.length;j++){
    (function(kw){
      var li2 = document.createElement('li');
      li2.className = 'kw-item';
      li2.innerHTML =
        '<b>' + kw.en + '</b> <span class="muted">(' + kw.ja + ')</span>' +
        '<div class="small muted">uses: ' + kw.uses + '</div>';
      li2.addEventListener('click', function(){
        copyKeyword(kw.en, kw.ja, kw.uses);
      });
      kUl.appendChild(li2);
    })(t.keywords[j]);
  }

  // Notes
  document.getElementById('notesArea').value = buildNotesText(t);

  log('Topic rendered: ' + t.title);
}

function buildNotesText(t){
  var today = getDateString();
  var lines = [];
  lines.push('ğŸŸ°SpeakUp Notes');
  lines.push(today);
  lines.push('');
  lines.push('Topic: ' + t.title);
  lines.push('');
  lines.push('Prompts:');
  for(var i=0;i<t.prompts.length;i++){
    lines.push('- ' + t.prompts[i]);
  }
  lines.push('');
  lines.push('Keywords:');
  for(var j=0;j<t.keywords.length;j++){
    var kw = t.keywords[j];
    lines.push('- ' + kw.en + ' = ' + kw.ja);
    lines.push('  uses: ' + kw.uses);
  }
  lines.push('');
  lines.push('---');
  lines.push('ã€Chat Memoï¼ˆä¼šè©±ã®è¦ç‚¹ï¼‰ã€‘');
  lines.push('- ');
  return lines.join('\n');
}

/* =========================
   4) Actions
========================= */
function copyKeyword(en, ja, uses){
  var text = en + ' = ' + ja + '\nuses:\n- ' + uses.replace(/ \/ /g, '\n- ');
  if(navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(text).then(function(){
      toast('ã‚³ãƒ”ãƒ¼ï¼š' + en);
      log('Keyword copied: ' + en);
    }).catch(function(e){
      toast('ã‚³ãƒ”ãƒ¼å¤±æ•—ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶åˆ¶é™ï¼‰');
      log('Clipboard error: ' + e.message);
    });
  }else{
    toast('ã‚³ãƒ”ãƒ¼éå¯¾å¿œã®ç’°å¢ƒã§ã™');
    log('Clipboard not supported');
  }
}

function copyNotes(){
  var v = document.getElementById('notesArea').value;
  if(navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(v).then(function(){
      toast('Notesã‚³ãƒ”ãƒ¼OK');
      log('Notes copied');
    }).catch(function(e){
      toast('ã‚³ãƒ”ãƒ¼å¤±æ•—ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶åˆ¶é™ï¼‰');
      log('Clipboard error: ' + e.message);
    });
  }else{
    toast('ã‚³ãƒ”ãƒ¼éå¯¾å¿œã®ç’°å¢ƒã§ã™');
    log('Clipboard not supported');
  }
}

function recordOpenedAndHistory(){
  var today = getDateString();
  localStorage.setItem('speakup_opened', today);

  var t = getTodayTopic();
  var kws = t.keywords.map(function(x){ return x.en; }).join(', ');

  try{
    var histData = localStorage.getItem('speakup_history');
    var history = histData ? JSON.parse(histData) : [];
    history.unshift({ date: today, topic: t.title, keywords: kws });
    if(history.length > 20) history.length = 20;
    localStorage.setItem('speakup_history', JSON.stringify(history));
    log('History saved');
  }catch(e){
    log('History save error: ' + e.message);
  }

  updateStatus();
}

function openChatGPT(){
  var t = getTodayTopic();

  var kw = t.keywords.map(function(x){ return x.en; }).join(', ');
  var qs = [];
  for(var i=0;i<t.prompts.length;i++){
    qs.push((i+1) + ') ' + t.prompts[i]);
  }

  var prompt =
    "Let's practice English speaking.\n\n" +
    "Today's topic: " + t.title + "\n\n" +
    "Rules: Ask me the questions one by one. After each answer, correct my English briefly and suggest a more natural alternative.\n\n" +
    "Questions:\n" + qs.join('\n') + "\n\n" +
    "Keywords to try using: " + kw + "\n\n" +
    "Start with question 1.";

  var url = 'https://chatgpt.com/?q=' + encodeURIComponent(prompt);

  recordOpenedAndHistory();
  toast('ChatGPTã‚’é–‹ãã¾ã™');
  log('Opening ChatGPT...');
  window.location.href = url;
}

/* =========================
   5) History
========================= */
function loadHistory(){
  var container = document.getElementById('historyContent');
  try{
    var data = localStorage.getItem('speakup_history');
    var history = data ? JSON.parse(data) : [];
    if(!history || history.length === 0){
      container.innerHTML = '<div class="muted">ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>';
      return;
    }
    var html = '';
    for(var i=0;i<history.length;i++){
      var item = history[i];
      html += '<div style="margin:10px 0; padding:10px; background:rgba(0,0,0,.22); border-radius:10px;">';
      html += '<b>' + item.date + '</b><br>';
      html += '<span class="small">' + item.topic + '</span><br>';
      html += '<span class="small muted">Keywords: ' + item.keywords + '</span>';
      html += '</div>';
    }
    container.innerHTML = html;
    log('History loaded');
  }catch(e){
    container.innerHTML = '<div class="muted">ã‚¨ãƒ©ãƒ¼: ' + e.message + '</div>';
    log('History load error: ' + e.message);
  }
}

function clearAllHistory(){
  localStorage.removeItem('speakup_history');
  toast('å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
  log('History cleared');
  loadHistory();
}

/* =========================
   6) Tabs
========================= */
function switchTab(num){
  document.getElementById('viewToday').className    = (num === 1) ? '' : 'hide';
  document.getElementById('viewHistory').className  = (num === 2) ? '' : 'hide';
  document.getElementById('viewSettings').className = (num === 3) ? '' : 'hide';

  document.getElementById('tab1').className = (num === 1) ? 'active' : '';
  document.getElementById('tab2').className = (num === 2) ? 'active' : '';
  document.getElementById('tab3').className = (num === 3) ? 'active' : '';

  if(num === 2) loadHistory();
  log('Switched tab: ' + num);
}

/* =========================
   7) Init
========================= */
window.addEventListener('load', function(){
  log('App started');
  updateStatus();
  renderTopic();

  // Buttons
  document.getElementById('btnSpeakUp').addEventListener('click', openChatGPT);
  document.getElementById('btnCopyNotes').addEventListener('click', copyNotes);

  document.getElementById('btnTestOpened').addEventListener('click', function(){
    recordOpenedAndHistory();
    toast('ä»Šæ—¥é–‹ã„ãŸã‚’è¨˜éŒ²');
  });
  document.getElementById('btnClearOpened').addEventListener('click', function(){
    localStorage.removeItem('speakup_opened');
    updateStatus();
    toast('ä»Šæ—¥é–‹ã„ãŸã‚’è§£é™¤');
    log('Opened flag cleared');
  });

  document.getElementById('btnClearAllHistory').addEventListener('click', clearAllHistory);

  // Tabs
  document.getElementById('tab1').addEventListener('click', function(){ switchTab(1); });
  document.getElementById('tab2').addEventListener('click', function(){ switchTab(2); });
  document.getElementById('tab3').addEventListener('click', function(){ switchTab(3); });
});
</script>
</body>
</html>
